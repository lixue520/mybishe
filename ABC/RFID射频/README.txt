硬件：
1、MCU（该程序使用STM32F103开发板）
2、RFID RC522读写器（淘宝购买，购买时会送两张MI卡）
软件:
1、串口调试助手
2、KEIl5开发工具
参考资料：
1、MCU（该程序使用STM32F103开发板）
2、stm32中文参考手册（V10）
3、Mifare1 S50IC卡中文说明书

实验说明：本程序可在51等单片机上运行，只需SPI接口，电源，注意RFID的电源范围，一块开发板，看懂程序后容易移植

实验程序内容：程序在网上下载案例，只实现读卡功能（网上大部分的资源大多是这种情况），于是对程序修改后进行编写，主要增加了STORE文件，实现钱包充值、扣款、密码修改，
还可进行拓展。

程序实现功能：
最主要的功能是进行管理员认证后执行相应操作
1、管理员权限卡（具有全部权限）
2、用户卡（只能获取本卡信息，用户卡消费，充值需先获取管理员权限），认证管理员卡后可进行充值等操作

实验步骤：
1、按key0键进行管理员认证
2、按key1键进行密码修改，密码内容没有做输入，暂时没做界面（需管理员认证，实际是无需管理员认证的，只是偷懒了以下）
3、按key2键进行充值（需管理员认证）

调试错误：
1、SPi的时钟极性和时钟相位没有设置正确，调试发现发送命令字后返回的结果不一致
2、RC522复位时间和启动时间间隔太短，导致读卡不灵敏
3、将扇区控制块的内容写错（格式错误，存储控制的数据和反码不一致，粗心导致），导致不能读写这个

钱包数据格式：
示例1：01 ff ff ff f7  0  0  0  01 ff ff ff 28 D7 28 D7   	//数据存放在0x28
示例2：3  0  0  0  fc  ff ff ff  3  0  0  0  8 f7  8 f7 	//数据存放在0x08
前4字节：金额
4-7    ：反码
8-11   ：备份金额
12-15  ：地址 地址反码 地址 地址反码 

管理员卡：扇区使用0x18-0x1B
1B:秘钥A：888888   控制字：f0 f0 f0 69  秘钥B：654321
18：块数据 FF BB E0 A8 C9 56 FE AC C4 D2 B6 7B 55 6B 3F 19
0f：秘钥A：123321   控制字：ff 07 80 69  秘钥B：010101
控制字说明：
块 0： C10 C20 C30  101	秘钥B认证后可读不可写
块 1： C11 C21 C31	101	秘钥B认证后可读不可写
块 2： C12 C22 C32	101	秘钥B认证后可读不可写
块 3： C13 C23 C33	101 秘钥A、B不可读写，验证秘钥B可改写控制字

用户卡：扇区使用0x0C-0x0F
0X0F:秘钥A:初始值:123456(用户可更改)  控制字：80 ff 87 69  秘钥B：960917
0X0C作为钱包存储
块 0： C10 C20 C30  110	秘钥A可读，可减，秘钥B：可读可写可增可减
块 1： C11 C21 C31	110	秘钥B认证后可读不可写
块 2： C12 C22 C32	110	秘钥B认证后可读不可写
块 3： C13 C23 C33	101 秘钥A、B不可读写，验证秘钥B可改写控制字


有不懂或代码不足之处欢迎讨论，联系邮箱：271022139@qq.com
